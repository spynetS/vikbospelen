<!-- This is the wrapper all livepatch components are wrapped around -->
<!-- it handles edits to the components.  -->
<div class="group relative " id="container-{{ uid }}" data-component-type="{{ component_template }}">
  {% if user.is_staff %}
  <div id="view-{{ uid }}" class="relative hover:outline hover:outline-2 hover:outline-indigo-500 rounded transition-all">
    {% include component_template %}
    
    <button onclick="openEditor('{{ uid }}')" 
            class="absolute top-0 left-0 w-full h-full cursor-pointer z-10 bg-indigo-500/0 hover:bg-indigo-500/5 transition-colors">
      <span class="absolute -top-2 -right-2 opacity-0 group-hover:opacity-100 bg-indigo-600 text-white px-2 py-1 rounded text-xs font-bold shadow-lg flex items-center gap-1">
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
      </span>
    </button>
  </div>

  <dialog id="editor-{{ uid }}" class="fixed inset-y-0 right-0 m-0 h-screen w-80 bg-white shadow-2xl border-l transform -translate-x-full transition-transform duration-300 backdrop:bg-black/20">
    <div class="flex flex-col h-full">
      <div class="p-4 border-b bg-gray-50 flex justify-between items-center">
        <h3 class="font-bold text-gray-700">Edit Component</h3>
        <button onclick="closeEditor('{{ uid }}')" class="text-gray-400 hover:text-gray-600">&times;</button>
      </div>

      <form hx-post="/livepatch/update/" 
            hx-target="#container-{{ uid }}" 
            hx-swap="innerHTML"
            class="flex-1 overflow-y-auto p-4 space-y-6">
        {% csrf_token %}
        <input type="hidden" name="id" value="{{ uid }}">
        <input type="hidden" name="name" value="{{ component_template }}">

        {% for field, value in public_fields.items %}
          <div class="space-y-1">
            <label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest">{{ field }}</label>
            
            {% if "COLOR" in field %}
              <div class="flex items-center gap-3 p-2 border rounded-lg">
                <input type="color" name="{{ field }}" value="{{ value }}" class="w-8 h-8 rounded border-none cursor-pointer">
                <input type="text" value="{{ value }}" class="text-xs font-mono text-gray-500 uppercase" readonly>
              </div>

            {% elif "TEXT" in field or "CONTENT" in field %}
              <textarea name="{{ field }}" rows="4" 
                        class="w-full text-sm border-gray-200 rounded-lg focus:border-indigo-500 focus:ring-indigo-500">{{ value }}</textarea>

            {% elif "ALIGN" in field %}
              <div class="grid grid-cols-3 gap-1 bg-gray-100 p-1 rounded-md">
                {% for opt in "left,center,right" %}
                  <label class="cursor-pointer">
                    <input type="radio" name="{{ field }}" value="{{ opt }}" {% if value == opt %}checked{% endif %} class="peer hidden">
                    <div class="peer-checked:bg-white peer-checked:shadow-sm text-center py-1 rounded text-xs text-gray-600 capitalize">{{ opt }}</div>
                  </label>
                {% endfor %}
              </div>

							{% elif "SIZE" in field %}
							<label id='size-label' class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest">{{ value }}%</label>
              <input type="range" name="{{ field }}" min="12" max="120" onchange="document.getElementById('size-label').innerHTML = this.value + '%'" value="{{ value|default:16 }}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">

							{% elif "SRC" in field %}
							<div class="space-y-4">
								<label class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest">Select or Upload Image</label>
								
								<div id="image-grid-{{ uid }}" class="grid grid-cols-3 gap-2 p-1">
									
									<label class="relative aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition-all cursor-pointer">
										<input type="file" name="new_image" accept="image/*" class="hidden"
													 hx-post="/livepatch/upload-image/" 
													 hx-encoding="multipart/form-data"
													 hx-target="#image-grid-{{ uid }}" 
													 hx-swap="beforeend">
										<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"></path></svg>
										<span class="text-[10px] font-medium text-gray-500 mt-1">Upload</span>
									</label>

									{% for image in images %}
									{% include "livepatch/editor_image_select.html" with field=field image=image current_value=current_value %}
									{% endfor %}
									
								</div>
							</div>
							
            {% else %}
              <input type="text" name="{{ field }}" value="{{ value }}" 
                     class="w-full text-sm border-gray-200 rounded-lg focus:border-indigo-500">
            {% endif %}

          </div>
					{% endfor %}
					
				<!-- private fields should be abled to be edited but should be included in the request -->
				{% for field, value in private_fields.items %}
					<input name="{{ field }}" type="text" value="{{ value|force_escape }}" class="hidden" />
        {% endfor %}

        <div class="sticky bottom-0 bg-white pt-4 pb-2 border-t mt-auto flex gap-2">
          <button type="submit" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700 transition-colors">Apply Changes</button>
          <button type="button" onclick="closeEditor('{{ uid }}')" class="px-4 py-2 border rounded-lg text-sm font-semibold">Cancel</button>
        </div>
      </form>
    </div>
  </dialog>

  <script>
    function openEditor(id) {
        const dialog = document.getElementById(`editor-${id}`);
        dialog.showModal();
        dialog.classList.remove('-translate-x-full');

    }
    function closeEditor(id) {
        const dialog = document.getElementById(`editor-${id}`);

				dialog.classList.add('-translate-x-full');
        setTimeout(() => dialog.close(), 300);
    }
  </script>

  {% else %}
    {% include component_template %}
  {% endif %}
</div>











